const startBtn = document.getElementById("start-btn");
const resultBtn = document.getElementById("result-btn");
const startScreen = document.getElementById("start-screen");
const quizScreen = document.getElementById("quiz-screen");
const resultScreen = document.getElementById("result-screen");
const questionText = document.getElementById("question-text");
const answersContainer = document.getElementById("answers-container");
const currentQuestion = document.getElementById("current-question");
const totalQuestions = document.getElementById("total-questions");
const scoreEl = document.getElementById("score");
const progressEl = document.getElementById("progress");
const finalScore = document.getElementById("final-score");
const maxScore = document.getElementById("max-score");
const resultMessage = document.getElementById("result-message");

const questions = [
	{
		question: "Which language runs in a web browser?",
		answers: ["Java", "C", "Python", "JavaScript"],
		correct: 3,
	},
	{
		question: "What does CSS stand for?",
		answers: [
			"Central Style Sheets",
			"Cascading Style Sheets",
			"Cascading Simple Sheets",
			"Cars SUVs Sailboats",
		],
		correct: 1,
	},
	{
		question: "What does HTML stand for?",
		answers: [
			"Hypertext Markup Language",
			"Hyperloop Machine Language",
			"Hyperlinks and Text Markup Language",
			"Home Tool Markup Language",
		],
		correct: 0,
	},
	{
		question: "Which company developed the React library?",
		answers: ["Google", "Facebook", "Netflix", "Microsoft"],
		correct: 1,
	},
	{
		question: "Inside which HTML element do we put JavaScript?",
		answers: ["<javascript>", "<script>", "<js>", "<code>"],
		correct: 1,
	},
	{
		question: "Which keyword creates a constant in JavaScript?",
		answers: ["var", "let", "const", "static"],
		correct: 2,
	},
	{
		question: "What selector targets an ID in CSS?",
		answers: ["#", ".", "*", "&"],
		correct: 0,
	},
	{
		question: "Which array method creates a new array with filtered items?",
		answers: ["map", "forEach", "filter", "reduce"],
		correct: 2,
	},
];

const state = {
	current: 0,
	score: 0,
	locked: false,
};

totalQuestions.textContent = questions.length;
maxScore.textContent = questions.length;

startBtn.addEventListener("click", startQuiz);
resultBtn.addEventListener("click", () => {
	switchScreen(startScreen);
});

function startQuiz() {
	state.current = 0;
	state.score = 0;
	scoreEl.textContent = 0;
	switchScreen(quizScreen);
	renderQuestion();
}

function renderQuestion() {
	const q = questions[state.current];
	state.locked = false;
	questionText.textContent = q.question;
	currentQuestion.textContent = state.current + 1;
	updateProgress(state.current);
	answersContainer.innerHTML = "";

	q.answers.forEach((text, index) => {
		const btn = document.createElement("button");
		btn.className = "answer-btn";
		btn.textContent = text;
		btn.dataset.correct = index === q.correct;
		btn.addEventListener("click", () => handleAnswer(btn));
		answersContainer.appendChild(btn);
	});
}

function handleAnswer(selectedBtn) {
	if (state.locked) return;
	state.locked = true;
	const isCorrect = selectedBtn.dataset.correct === "true";
	if (isCorrect) {
		state.score += 1;
		scoreEl.textContent = state.score;
		selectedBtn.classList.add("correct");
	} else {
		selectedBtn.classList.add("wrong");
	}

	Array.from(answersContainer.children).forEach((btn) => {
		btn.disabled = true;
		if (btn.dataset.correct === "true") {
			btn.classList.add("correct");
		}
	});

	updateProgress(state.current + 1);

	setTimeout(() => {
		state.current += 1;
		if (state.current >= questions.length) {
			showResults();
		} else {
			renderQuestion();
		}
	}, 700);
}

function showResults() {
	finalScore.textContent = state.score;
	resultMessage.textContent = buildMessage();
	switchScreen(resultScreen);
}

function buildMessage() {
	const ratio = state.score / questions.length;
	if (ratio === 1) return "Perfect score!";
	if (ratio >= 0.75) return "Great job!";
	if (ratio >= 0.5) return "Nice effort, keep going.";
	return "Keep practicing and try again.";
}

function updateProgress(current) {
	const percent = (current / questions.length) * 100;
	progressEl.style.width = `${percent}%`;
}

function switchScreen(target) {
	[startScreen, quizScreen, resultScreen].forEach((el) => {
		el.classList.toggle("active", el === target);
	});
}
